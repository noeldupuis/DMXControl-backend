image: ubuntu:xenial

before_script:
  - apt update && apt upgrade && apt install psmisc
  - fuser -k 3000/tcp && fuser -k 3000/udp
  - apt update && apt upgrade

stages:
  - build
  - deploy

build:
  stage: build
  tags: 
    - docker
  script:
    - apt install -y curl
    - curl -sL https://deb.nodesource.com/setup_6.x | bash -
    - apt install nodejs
    - npm install
    - npm build

deploy:
  stage: deploy
  only:
    - master
  tags: 
    - ssh
  script:
    - apt install nodejs
    - npm install
    - forever start app.js
